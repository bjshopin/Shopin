<!-- GFM-TOC -->
* [上品科技研发编码规范](#上品研发编码规范)
    * [1. 命名规范](#1-命名规范)
        * [1.1 通用规范](#11-通用规范)
        * [1.2 包名规范](#12-包名规范)
        * [1.3 类名规范](#13-类名规范)
          * [1.3.1 统一类名-驼峰命名法](#131-统一类名驼峰命名法)
          * [1.3.2 抽象类命名](#132-抽象类命名)
          * [1.3.3 异常类命名](#133-异常类命名)
          * [1.3.4 接口和实现类的命名](#134-接口和实现类的命名)
          * [1.3.5 枚举类命名](#135-枚举类命名)
          * [1.3.6 MVC各层命名](#136-mvc各层命名)
        * [1.4 变量命名](#14-变量命名)
          * [1.4.1 方法参数名,局部变量,成员变量](#141-方法参数名局部变量成员变量) 
          * [1.4.2 布尔变量](#142-布尔变量)
          * [1.4.3 包装类变量](#143-包装类变量)
        * [1.5 常量命名](#15-常量命名)
        * [1.6 数组命名](#16-数组命名)
        * [1.7 方法的命名](#17-方法的命名)
    * [2. 格式规约](#2-格式规约)
        * [2.1 IDE设置](#21-IDE设置)
        * [2.2 大括号的使用约定](#22-大括号的使用约定)
        * [2.3 单行字符过长需换行](#23-单行字符过长需换行)
    * [3. OOP规约](#3-oop规约)
        * [3.1 异常处理](#31-异常处理)
        * [3.2 包装类使用规约](#32-包装类使用规约)
        * [3.3 面向对象规约](#33-面向对象规约)
    * [4. 注释规约](#4-注释规约)
        * [4.1 类注释](#41-类注释) 
        * [4.2 方法注释](#42-方法注释)
        * [4.3 API注释](#43-api注释)
        * [4.4 接口注释](#44-接口注释)
        * [4.5 枚举注释](#45-枚举注释)
        * [4.6 需求注释](#46-需求注释)
          * [4.6.1 在他人代码中增加代码](#461-在他人代码中增加代码)
          * [4.6.2 修改他人代码](#462-修改他人代码)
          * [4.6.3 删除他人代码](#463-删除他人代码)
        * [4.7 废弃代码注释](#47-废弃代码注释)
    * [5. 控制语句](#5-控制语句)
    * [6. 页面控制](#6-页面控制)
    * [7. 线程池使用规范](#7-线程池使用规范)
        * [7.1 线程池介绍](#71-线程池介绍)
        * [7.2 线程池参数设置以及意义](#72-线程池参数设置以及意义)
        * [7.3 线程池之线程命名规范](#73-线程池之线程命名规范)
        * [7.4 线程池监控](#74-线程池监控)
    * [8. 缓存使用规范](#8-缓存使用规范)
        * [8.1 分布式缓存介绍](#81-分布式缓存介绍)
        * [8.2 Redis原理](#82-redis原理)
           * [8.2.1 Hash环](#821-hash环)
           * [8.2.2 分布式锁](#822-分布式锁)
           * [8.2.3 CAS](#823-cas)
        * [8.3 缓存的Key命名规范](#83-缓存的key命名规范)
        * [8.4 缓存的Value使用规范](#84-缓存的value使用规范)
        * [8.5 缓存的失效时间设置](#85-缓存的失效时间设置)
        * [8.6 缓存常见问题](#86-缓存常见问题)
           * [8.6.1 缓存击穿](#861-缓存击穿)
           * [8.6.2 雪崩](#862-雪崩)
<!-- GFM-TOC -->

# 上品科技研发编码规范
## 1. 命名规范
### 1.1 通用规范
 - [**必须**]代码中的命名**严禁使用拼音与英文混合**的方式,更不允许直接使用中文的方式;
```
  反例: DaZhePromotion [打折促销]
        Long 上品折扣 = 123456L;
  正例: discountPromotion
```
 - [**必须**]代码中的命名均不能以**下划线或美元符号**开始,也不能以下划线或美元符号结束。
```
  反例: _name/__name/$Object
```
 - [**必须**]杜绝完全不规范的命名方式,避免望文不知义.
```
   反例: Condition condi = new Condition();
   正例: Condition condition = new Condition();
```
### 1.2 包名规范

  - [**必须**]包名:全部小写,分隔符之间是一个自然语义的英文单词。包名统一使用单数形式;

### 1.3 类名规范
#### 1.3.1 统一类名(驼峰命名法)
 - [**必须**]类名使用 **UpperCamelCase** 风格, 必须遵从驼峰形式,但以下情景除外(领域模型的相关命名)DO/BO/DTO/VO等;
```
正例: MarcoPolo / UserDO / XmlService / TcpUdpDeal / TaPromotion
反例: macroPolo / UserDo / XMLService / TCPUDPDeal / TAPromotion
```
#### 1.3.2 抽象类命名
 - [**必须**]抽象类命名使用Abstract 或Base 开头.
```
正例:  AbstractAspectJAdvice
反例:  AspectJAdvice
```
#### 1.3.3 异常类命名
 - [**必须**]异常类命名使用Exception结尾;
 - [**必须**]自定义异常需继承**ShopinException**(TODO:待完善)
#### 1.3.4 接口和实现类的命名
 - [**必须**]对于Service和DAO类,基于SOA思想,暴露出来的一定是接口,内部的实现类用Impl的后缀.
```
  正例:CacheServiceImpl实现CacheService接口;
```
#### 1.3.5 枚举类命名
 - [参考]枚举类命名建议带上**Enum后缀**,枚举成员名称需要全大写,单词之间用下划线隔开。
```
  说明: 枚举其实就是特殊的常量类,且构造方法被默认强制为私有。
  正例: 枚举名: DealStatusEnum ,成员名称: SUCCESS,FAIL,UN_KNOWN
```
#### 1.3.6 MVC各层命名
 - [参考]Service/DAO层方法命名规约:
   - **获取单个对象的方法用get作为前缀**,例如getUserById();
   - **获取多个对象的方法用list作为前缀**,例如 listUserByStatus();
   - **获取统计值的方法用count作为前缀**。
   - **插入的方法用save(推荐)或insert作为前缀**.
   - **删除的方法用remove(推荐)或delete作为前缀**.
   - **修改的方法用update作为前缀**.
 - [参考]领域模型命名规范
   - **数据对象**: xxxDO,xxx即为数据库表名
   - **数据传输对象**: xxxDTO,xxx为业务领域相关的名称;
   - **展示对象**: xxxVO,xxx一般为向前台展示的页面名称;
   - **POJO是DO/DTO/VO的统称**,禁止命名为xxxPOJO;
### 1.4 变量命名
#### 1.4.1 方法参数名,局部变量,成员变量
 - [**必须**]方法参数名,局部变量,成员变量统一使用lowerCamelCase风格编码。
#### 1.4.2 布尔变量
 - [推荐]布尔变量的命名目的在于给布尔变量赋予隐含”真假”含义的名字.
```
  正例: boolean isDone
```
#### 1.4.3 包装类变量
 - [**必须**]Long类型变量,严禁使用小写字母作为结束后缀.
```
  反例: Long num=12345l (小写容易跟数字1混淆,造成误解)
  正例: Long num=12345L
```

### 1.5 常量命名
 - [**必须**]量命名需要大写
```
  常量命名全部大写,单词之间以下划线隔开,力求语义表达完整,不要怕过长(英文单词忘记,在旁边备注)。
```
```
 正例: MAX_STOCK_COUNT
 反例: MAXSTOCKCOUNT
```
 - [**必须**]常量不允许出现任何魔法值(即未经定义的常量)直接出现在代码里.
```
  反例: String key=”ID#shopin_”+tradeId;
```

### 1.6 数组命名
 - [必须]数组命名,将中括号放置于类型名之后,切忌仿照C++/C代码中数组定义形式;
```
  反例: int[] arr=new int[10];
  正例: int arr[]=new int[10];
```
### 1.7 方法的命名
 - 方法命名必须用一个小写字母开头，后面的单词用大写字母开头。
```
  正例: private boolean insertProgress(int nCode)
```
 - 对一般属性的取值,赋值采用 get/set方法。
```
  正例: prublic void setParameters(String strName)
```
 - 对具有Boolean值的属性使用 is/set命名模式。
```
  正例:  public boolean isRunning()
         public void setRunning(boolean bRunning)
```
 - 变换类型的方法
```
   正例:public toInt();
```
 - 静态工厂 valueOf
```
   正例: 
      public static Boolean valueOf(boolean b) {
         return (b ? Boolean.TRUE : Boolean.FALSE);
    }
```

## 2.格式规约
### 2.1 IDE设置
 - 【必须】<font color="red">缩进使用4个空格,禁止使用未统一设置的tab键</font>
    - 说明
```
  在IDE中设置tab长度为4个空格(避免未设置之前一个tab在不同的编辑器中长度不同引起代码冲突);
```

![](https://github.com/bjshopin/Shopin/blob/master/%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%8F%B0SOA%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%A7%84%E8%8C%83/img/Tab%E9%94%AE%E8%AE%BE%E7%BD%AE%E4%B8%BA4%E4%B8%AA%E7%A9%BA%E6%A0%BC.png?raw=true)

 - 【必须】<font color="red">IDE的text file encoding编码格式设置为 UTF-8</font>
  ![](https://raw.githubusercontent.com/bjshopin/Shopin/master/%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%8F%B0SOA%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%A7%84%E8%8C%83/img/File-Encoding.png)
 - 【必须】<font color="red">IDE中文件的换行符使用Unix格式,严禁使用Window格式</font>
 ![](https://github.com/bjshopin/Shopin/blob/master/%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%8F%B0SOA%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%A7%84%E8%8C%83/img/Line-Separator.png?raw=true)
 - 【必须】<font color="red">文档化</font>
```
   必须用javadoc来为类生成文档。不仅因为它是标准，这也是被各种java编译器都认可的方法。
```

### 2.2 大括号的使用约定
 - 【必须】如果大括号内为空,则简洁地写成{}即可,不需要换行;
```
   正例: public void swap(){}
   反例: public void swap(){
       
       }
```
 - 【必须】如果大括号内是非空代码块的话，则:
   - 左大括号前不换行。
   - 左大括号后换行。
   - 右大括号前换行。
   - 右大括号后还有else等代码则不换行;表示终止右大括号后必须换行;

### 2.3 单行字符过长需换行
 - 【必须】单行字符限制不超过120个,超出需要换行，换行时遵循一下原则:
    - 第二行相对第一行缩进4个空格,从第三行开始,不在继续缩进，参考示例。
    - 运算符与下文一起换行。
    - 方法调用的点符号与下文一起换行。
    - 在多个参数超长,逗号后进行换行。
    - 在括号前不要换行,见反例。

```
正例:
     StringBuffer sb = new StringBuffer();
// 超过120个字符的情况下,换行超过4个空格,并且方法前的点符号一起换行.
         sb.append("shopin").append(".net")……
         .append("www")……
         .append("shopin.cn");
反例：
     StringBuffer sb = new StringBuffer();
     //超过120个字符的情况下,不要在括号前换行
     sb.append("shopin").append(".net")……append
         ("www")……
      
     //参数很多的时候调用可能超过120个字符,不要再逗号之前换行。
     method(args1,args2,args3,…
           ,argsX);
```
## 3.OOP规约
### 3.1 异常处理
```
   TODO
```
### 3.2 包装类使用规约
  - 【必须】所有相同类型的包装类对象之间值的比较,全部使用equals方法比较。
```
   【说明】:在包装类(Byte,Short,Integer,Long)中,我们以Integer为例,在[-128,127]之间的赋值,
   Integer对象是在IntegerCache.cache产生,会复用已有对象，这个区间内的Integer值可以直接使用==进行判断
   (比较内存地址,因为复用同一个对象,所以相同)。但是这个区间之外的数据,都会在堆上产生，
   并不会复用已有对象，所以必须使用equals()方法进行比较.
```
  - 【必须】关于基本数据类型与包装类的使用标准:
    - 所有的POJO类属性必须使用包装数据类型。
    - RPC方法的返回值和参数必须使用包装数据类型
    - 所有的局部变量【参考】使用基本数据类型。
```
 【说明】:POJO类属性没有初值是提醒使用者在需要使用时,必须显性地进行赋值，任何NPE(空指针)问题，或者入库检查，都由使用者来保证。
```
```
  正例:数据库的查询结果为null,因为自动拆箱,用基本数据类型接收有NPE风险。
  反例:比如显示库存信息,即正负x件，x为基本数据类型，调用的RPC服务，调用不成功时,返回的是默认值，
  页面显示:0件，这是不合理的，应该显示成中划线-。所以包装数据类型的null值，
  能够表示额外的信息，如:远程调用失败，异常退出。
```
  - 【必须】列化类新增属性时,请不要修改serialVersionUID字段,避免反序列失败;如果完全不兼容升级，避免反序列化混乱,那么请修改serialVersionUID值。
```
  【说明】注意serialVersionUID不一致会抛出序列化运行时异常。
```
  - 【必须】构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，放到init()中去。
  - 【必须】POJO类必须写toString()方法。如果继承了另一个POJO类,注意在前面加一下super.toString()。
```
  【说明】在方法执行抛出异常时,可以直接用POJO的toString()方法打印其属性值,便于排查问题。
```
  - 【推荐】final可提高程序响应效率,声明为final的情况：
     - 不需要重新赋值的变量,包括类属性,局部变量。
     - 对象参数前加final,表示不允许修改引用的指向。
     - 类方法前加final,表示不允许被重写。
### 3.3 面向对象规约
  - 【必须】所有的覆盖方法,必须加 @Override 注解
  - 【必须】Object的equals方法容易抛空指针异常,应使用常量或确定有值的对象来调用equals;
```
  正例: "tests".equals(object);
  反例: object.equals(“tests”);
```
## 4. 注释规约
### 4.1 类注释
 - 【必须】所有的类都必须添加创建者信息(统一命名)
    - 配置模板说明:
```
/**
 * <p>ClassName:类名</p>
 * <p>Description: 添加类信息描述</p>
 * <p>Company: 公司信息</p>
 * @author 开发者信息 
 * @version  版本号
 * @Date 开发时间
 */
```
设置教程:</br>
![](https://github.com/bjshopin/Shopin/blob/master/%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%8F%B0SOA%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%A7%84%E8%8C%83/img/IDEA-ClassSetting.png)

 - 【必须】类,类属性，类方法的注释必须使用javadoc规范,使用/**内容*/格式，不得使用//xxx方式;
```
  【说明】在IDE编辑窗口中, Javadoc 方式会提示相关注释，生成 Javadoc 可以正确输出相应注释; 
  在 IDE 中，工程调用方法时，不进入方法即可悬浮提示方法、参数、返回值的意义，提高阅读效率。
```
### 4.2 方法注释
 - 配置模板说明
```
   @Override
    /**
     * <p>selectUserById : 一句话描述该方法作用</p>
     * @param id
     * @version 1.0 
     * @throws
     * @author zhangyong@shopin.cn
     * @date  
     * @return net.shopin.app.User
     * @since 禅道需求地址/更新说明
     */
    public User selectUserById(Long id) {
        return userMapper.selectUserById(id);
    }

```
 - IDE配置说明</br>
[Idea配置自定义方法注释说明](https://blog.csdn.net/u014044812/article/details/76577479)
####  4.2.1 单行注释
 - 【必须】方法内部单行注释,在被注释语句上方另起一行，使用//注释。方法内部多行注释使用/* */注释，注意和代码对齐。
#### 4.2.2 多行注释
 - 【必须】所有的抽象方法(包括接口中的方法)必须要用javadoc注释，除了返回值，参数，异常说明外，还必须指出该方法做什么事情，实现什么功能
```
  【说明】对子类的实现要求,或者调用注意事项，请一并说明。
```
### 4.3 API注释
 - 【必须】作为方法注释去操作, 添加调用者信息(即哪些系统会调用,ssd-service中存在大量不同子系统调用同一个接口的情况,但是并没有标注范围,为统计API增加了时间成本);

### 4.4 接口(Service)注释
 - 【必须】所有的抽象方法(包括接口中的方法)必须要用javadoc注释，除了返回值，参数，异常说明外，还必须指出该方法做什么事情，实现什么功能
```
  【说明】对子类的实现要求,或者调用注意事项，请一并说明。
```
注释模板:
```
    正例:
    /**
     * sheild:(这里用一句话描述这个方法的作用). <br/>
     *
     * @param supplySid     supplySid 供应商ID
     * @param brandErpSid   ERP品牌ID，‘B098’
     * @param proDetailSid   物料ID
     * @param optType      操作类型 default : 0,1：已屏蔽
     * @param optUser      操作人
     * @return 
     * @author zhangyong@shopin.cn
     * @since version 1.0.2
     */
    int sheild(long supplySid, String brandErpSid, long proDetailSid, int optType, String optUser);
```
### 4.5 枚举注释
```
  【必须】所有的枚举类型字段必须要有注释，说明每个数据项的用途。
```
### 4.6 需求注释
#### 4.6.1 在他人代码中增加代码
```
  当需要在他人代码中增加(新增)代码时,请按照如下规则增加相对应注释:
  
/**Add By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD Begin
 * 禅道需求编号: 添加上禅道相对应的地址;
 */
……(所增加的代码)
//Add By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD End
```
#### 4.6.2 修改他人代码
```
  当需要修改他人写的代码的的时候，请按照如下规则增加注释并修改代码：

/**
 * Modify By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD Begin
 * 禅道需求编号: 添加上禅道相对应的地址
 */
 /*
  *………(他人写的变更前的代码)
  */
…………(变更后的代码)
//Modify By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD End
```
#### 4.6.3 删除他人代码
```
  当需要删除他人写的代码的时候 ，请按照如下规则删除并增加注释：

/**
 * Remove By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD Begin
 * 删除原因: 必须添加删除原因, 
 *  禅道需求编号: 添加上禅道相对应的地址
 */
 
 /*
  * …………(要删除的代码)
  */
//Remove By XXX（英文名字） For XXXXX(功能或模块，最好用英文) In YYYY-MM-DD End
```
### 4.7 废弃代码注释
 - 【必须】注释掉的代码尽量配合上说明信息;
```
  1)后续存在恢复这段代码逻辑;
  2)永久不用,建议删除(git中保存了历史代码);
```

## 5. 控制语句
 - 【必须】在一个switch块中，每一个case要么通过break/return等来终止，要么注释说明程序将继续执行到哪一个case为止;在一个switch块内，都必须包含一个default语句并且放到最后，即使它什么代码也没有;
 - 【强制】在 if/else/for/while/do 语句中必须使用大括号，即使只有一行代码。
```
  反例: if(condition) statements;
  正例: if(condition){
      statements;
  }
```
## 6. 页面控制

## 7. 线程池使用规范
### 7.1 线程池介绍
### 7.2 线程池参数设置以及意义
### 7.3 线程池之线程命名规范
### 7.4 线程池监控
## 8. 缓存使用规范
### 8.1 分布式缓存介绍
### 8.2 Redis原理
#### 8.2.1 Hash环
#### 8.2.2 分布式锁
#### 8.2.3 CAS
### 8.3 缓存的Key命名规范
### 8.4 缓存的Value使用规范
### 8.5 缓存的失效时间配置
### 8.6 缓存常见问题
#### 8.6.1 缓存击穿
#### 8.6.2 雪崩
 